{% extends 'base.html' %}
{% block title %}Panel Administratora{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 class="mb-4">Panel Administratora</h1>

  <div class="card mb-4">
    <div class="card-header bg-warning text-white">
      <strong>Studenci oczekujƒÖcy na zatwierdzenie</strong>
    </div>
    <div class="card-body">
      {% if pending_students %}
      <ul class="list-group">
        {% for s in pending_students %}
        <li
          class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            {{ s.name }} {{ s.surname }}<br>
            <small class="text-muted">{{ s.email }}</small>
          </div>
          <form method="POST" action="{{ url_for('admin_dashboard') }}"
            class="mb-0">
            <input type="hidden" name="student_id" value="{{ s.id }}">
            <button name="action" value="approve_student"
              class="btn btn-sm btn-success me-1">‚úÖ Zatwierd≈∫</button>
            <button name="action" value="delete_student"
              class="btn btn-sm btn-danger">‚ùå Usu≈Ñ</button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted mb-0">Brak student√≥w oczekujƒÖcych.</p>
      {% endif %}
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header bg-info text-white">
      <strong>Nauczyciele oczekujƒÖcy na zatwierdzenie</strong>
    </div>
    <div class="card-body">
      {% if pending_teachers %}
      <ul class="list-group">
        {% for t in pending_teachers %}
        <li
          class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            {{ t.name }} {{ t.surname }}<br>
            <small class="text-muted">{{ t.email }}</small>
          </div>
          <form method="POST" action="{{ url_for('admin_dashboard') }}"
            class="mb-0">
            <input type="hidden" name="teacher_id" value="{{ t.id }}">
            <button name="action" value="approve_teacher"
              class="btn btn-sm btn-success me-1">‚úÖ Zatwierd≈∫</button>
            <button name="action" value="delete_teacher"
              class="btn btn-sm btn-danger">‚ùå Usu≈Ñ</button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted mb-0">Brak nauczycieli oczekujƒÖcych.</p>
      {% endif %}
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <strong>Przypisz zatwierdzonych student√≥w</strong>
    </div>
    <div class="card-body">
      {% if unassigned_students %}
      <ul class="list-group mb-4">
        {% for s in unassigned_students %}
        <li class="list-group-item d-flex align-items-center flex-wrap">
          <div class="flex-grow-1">
            <strong>{{ s.name }} {{ s.surname }}</strong><br>
            <small class="text-muted">{{ s.email }}</small>
          </div>
          <form method="POST" action="{{ url_for('admin_dashboard') }}"
            class="d-flex align-items-center mb-0">
            <input type="hidden" name="student_id" value="{{ s.id }}">
            <select name="teacher_ids" multiple
              class="form-select form-select-sm me-2" style="min-width:200px">
              {% for t in approved_teachers %}
              <option value="{{ t.id }}">{{ t.name }} {{ t.surname }}</option>
              {% endfor %}
            </select>
            <button name="action" value="assign_student"
              class="btn btn-sm btn-primary">üìù Przypisz</button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted">Brak student√≥w do przypisania.</p>
      {% endif %}
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header bg-secondary text-white">
      <strong>Wszyscy u≈ºytkownicy w systemie</strong>
    </div>
    <div class="card-body">
      <h6>Studenci</h6>
      {% if assigned_students %}
      <ul class="list-group mb-4">
        {% for s in assigned_students %}
        <li class="list-group-item">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong>{{ s.name }} {{ s.surname }}</strong><br>
              <small class="text-muted">{{ s.email }}</small>
            </div>
            <form method="POST"
              action="{{ url_for('admin_dashboard') }}"
              class="d-flex align-items-center">
              <input type="hidden" name="student_id" value="{{ s.id }}">
              <select
                name="teacher_ids"
                multiple
                class="form-select form-select-sm js-choices me-2"
                style="min-width:250px"
                placeholder="Wybierz nauczycieli">
                {% for t in approved_teachers %}
                <option value="{{ t.id }}" {% if t in s.teachers %}selected{%
                  endif %}>
                  {{ t.name }} {{ t.surname }}
                </option>
                {% endfor %}
              </select>
              <button name="action" value="update_teachers"
                class="btn btn-sm btn-primary me-2">
                üíæ
              </button>
              <button name="action" value="delete_student"
                class="btn btn-sm btn-danger">
                ‚ùå
              </button>
            </form>
          </div>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted">Brak uczni√≥w w systemie.</p>
      {% endif %}

      <h6>Nauczyciele</h6>
      {% if approved_teachers %}
      <ul class="list-group">
        {% for t in approved_teachers %}
        <li
          class="list-group-item d-flex justify-content-between align-items-center">
          {{ t.name }} {{ t.surname }} <small class="text-muted">({{ t.email }},
            {{ t.subject }})</small>
          <form method="POST" action="{{ url_for('admin_dashboard') }}"
            class="mb-0">
            <input type="hidden" name="teacher_id" value="{{ t.id }}">
            <button name="action" value="delete_teacher"
              class="btn btn-sm btn-danger">
              ‚ùå
            </button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted">Brak nauczycieli w systemie.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
