{% extends 'base.html' %}
{% block title %}Panel Administratora{% endblock %}

{% block content %}
<div class="admin-dashboard">
  <h1 class="admin-dashboard__title">Panel Administratora</h1>

  <!-- Studenci oczekujƒÖcy -->
  <div class="admin-dashboard__card">
    <div class="admin-dashboard__header--warning">
      <strong>Studenci oczekujƒÖcy na zatwierdzenie</strong>
    </div>
    <div class="admin-dashboard__body">
      {% if pending_students %}
      <ul class="admin-dashboard__list">
        {% for s in pending_students %}
        <li class="admin-dashboard__list-item">
          <div>
            <strong>{{ s.name }} {{ s.surname }}</strong><br>
            <small class="text-muted">{{ s.email }}</small>
          </div>
          <form method="POST" action="{{ url_for('admin_dashboard') }}" class="admin-dashboard__form">
            <input type="hidden" name="student_id" value="{{ s.id }}">
            <button name="action" value="approve_student" class="admin-dashboard__btn--approve">‚úÖ Zatwierd≈∫</button>
            <button name="action" value="delete_student" class="admin-dashboard__btn--delete">‚ùå Usu≈Ñ</button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted mb-0">Brak student√≥w oczekujƒÖcych.</p>
      {% endif %}
    </div>
  </div>

  <!-- Nauczyciele oczekujƒÖcy -->
  <div class="admin-dashboard__card card">
    <div class="admin-dashboard__header--info">
      <strong>Nauczyciele oczekujƒÖcy na zatwierdzenie</strong>
    </div>
    <div class="admin-dashboard__body">
      {% if pending_teachers %}
      <ul class="admin-dashboard__list">
        {% for t in pending_teachers %}
        <li class="admin-dashboard__list-item">
          <div>
            <strong>{{ t.name }} {{ t.surname }}</strong><br>
            <small class="text-muted">{{ t.email }}</small>
          </div>
          <form method="POST" action="{{ url_for('admin_dashboard') }}" class="admin-dashboard__form">
            <input type="hidden" name="teacher_id" value="{{ t.id }}">
            <button name="action" value="approve_teacher" class="admin-dashboard__btn--approve">‚úÖ Zatwierd≈∫</button>
            <button name="action" value="delete_teacher" class="admin-dashboard__btn--delete">‚ùå Usu≈Ñ</button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted mb-0">Brak nauczycieli oczekujƒÖcych.</p>
      {% endif %}
    </div>
  </div>

  <!-- Przypisanie student√≥w -->
  <div class="admin-dashboard__card">
    <div class="admin-dashboard__header--primary">
      <strong>Przypisz zatwierdzonych student√≥w</strong>
    </div>
    <div class="admin-dashboard__body">
      {% if unassigned_students %}
      <ul class="admin-dashboard__list">
        {% for s in unassigned_students %}
        <li class="admin-dashboard__list-item--wrap">
          <div>
            <strong>{{ s.name }} {{ s.surname }}</strong><br>
            <small class="text-muted">{{ s.email }}</small>
          </div>
          <form method="POST" action="{{ url_for('admin_dashboard') }}" class="admin-dashboard__form">
            <input type="hidden" name="student_id" value="{{ s.id }}">
            <select name="teacher_ids" multiple class="admin-dashboard__select">
              {% for t in approved_teachers %}
              <option value="{{ t.id }}">{{ t.name }} {{ t.surname }}</option>
              {% endfor %}
            </select>
            <button name="action" value="assign_student" class="admin-dashboard__btn--update">üìù Przypisz</button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted">Brak student√≥w do przypisania.</p>
      {% endif %}
    </div>
  </div>

  <!-- Wszyscy u≈ºytkownicy -->
  <div class="admin-dashboard__card">
    <div class="admin-dashboard__header--secondary">
      <strong>Wszyscy u≈ºytkownicy w systemie</strong>
    </div>
    <div class="admin-dashboard__body">

      <h6>Studenci</h6>
      {% if assigned_students %}
      <ul class="list-group">
        {% for s in assigned_students %}
        <li class="list-group-item">
          <div class="admin-dashboard__form--space-between">
            <div>
              <strong>{{ s.name }} {{ s.surname }}</strong><br>
              <small class="text-muted">{{ s.email }}</small>
            </div>
            <form method="POST" action="{{ url_for('admin_dashboard') }}" class="admin-dashboard__form" style="height: 100px;">
              <input type="hidden" name="student_id" value="{{ s.id }}">
              <div class="d-flex align-items-center gap-2">
                <select name="teacher_ids" multiple class="admin-dashboard__select js-choices" placeholder="Wybierz nauczycieli">
                  {% for t in approved_teachers %}
                  <option value="{{ t.id }}" {% if t in s.teachers %}selected{% endif %}>{{ t.name }} {{ t.surname }}</option>
                  {% endfor %}
                </select>
                <button name="action" value="update_teachers" class="admin-dashboard__btn--update me-2">üíæ</button>
                <button name="action" value="delete_student" class="admin-dashboard__btn--delete">‚ùå</button>
              </div>
            </form>
          </div>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted">Brak uczni√≥w w systemie.</p>
      {% endif %}

      <h6>Nauczyciele</h6>
      {% if approved_teachers %}
      <ul class="admin-dashboard__list">
        {% for t in approved_teachers %}
        <li class="admin-dashboard__list-item">
          <div>
            <strong>{{ t.name }} {{ t.surname }}</strong><br>
            <small class="text-muted">({{ t.email }}, {{ t.subject }})</small>
          </div>
          <form method="POST" action="{{ url_for('admin_dashboard') }}" class="admin-dashboard__form">
            <input type="hidden" name="teacher_id" value="{{ t.id }}">
            <button name="action" value="delete_teacher" class="admin-dashboard__btn--delete">‚ùå</button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p class="text-muted">Brak nauczycieli w systemie.</p>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}